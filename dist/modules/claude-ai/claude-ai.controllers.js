"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const sdk_1 = __importDefault(require("@anthropic-ai/sdk"));
const client = new sdk_1.default({
    apiKey: process.env.ANTHROPIC_API_KEY || "",
});
const sendUnimed = async (req, res) => {
    try {
        const { conversationHistory } = req.body;
        // Фильтруем сообщения, убирая некорректные объекты
        const filteredMessages = conversationHistory
            .filter((msg) => msg.content && msg.role) // Оставляем только валидные
            .map((msg) => ({
            role: msg.role,
            content: msg.content,
        }));
        // Если после фильтрации сообщений нет — ошибка
        if (filteredMessages.length === 0) {
            res.status(400).send({
                success: false,
                message: "conversationHistory не содержит валидных сообщений",
            });
            return;
        }
        try {
            const message = await client.messages.create({
                max_tokens: 1024,
                system: "Тебя зовут Айчурок! Ты будешь отвечать на чат клиентам. Будешь очень умная, образованная и приветливая, рада будешь помочь. Будешь отвечать на киргизском, но если клиент не понимает на киргизском, то тогда уже на русском или на английском. Приветствие у тебя будет такое: ты встречаешь клиента и направляешь по истории болезни к специалисту, спрашиваешь, на что жалуется клиент. Если нужен дополнительный номер, покажешь этот номер 0999 99 88 66.",
                messages: filteredMessages,
                model: "claude-3-5-haiku-20241022",
            });
            const { content } = message;
            res.status(201).send({
                success: true,
                results: {
                    content,
                },
            });
        }
        catch (e) {
            res.status(500).send({
                success: false,
                results: `Error in ClaudeAi: ${e}}`,
            });
        }
    }
    catch (e) {
        res.status(500).send({
            success: false,
            message: `Error in sendUnimed: ${e}`,
        });
    }
};
const sendUnicorn = async (req, res) => {
    try {
        const { conversationHistory } = req.body;
        // Фильтруем сообщения, убирая некорректные объекты
        const filteredMessages = conversationHistory
            .filter((msg) => msg.content && msg.role) // Оставляем только валидные
            .map((msg) => ({
            role: msg.role,
            content: msg.content,
        }));
        // Если после фильтрации сообщений нет — ошибка
        if (filteredMessages.length === 0) {
            res.status(400).send({
                success: false,
                message: "conversationHistory не содержит валидных сообщений",
            });
            return;
        }
        try {
            const message = await client.messages.create({
                max_tokens: 1024,
                system: `
						Вы — дружелюбный и профессиональный ассистент компании Aksoft, основанной в 2022 году. 
						Ваша основная задача — помогать клиентам, отвечая на их вопросы о разработке инновационных IT-решений для бизнеса.
		
						Основная информация:
						- Компания: Aksoft (основана в 2022 году)
						- Специализация: разработка инновационных IT-решений для бизнеса
						- Email для связи: aksoftkg@gmail.com
						- Телефон: 0999886644
		
						Стиль общения:
						- Профессиональный, но дружелюбный
						- Приветствуется уместный юмор
						- Всегда предлагайте конкретные решения
						- В конце ответа, если это уместно, предлагайте контактную информацию (email или телефон)
		
						На технические и специализированные вопросы отвечайте компетентно, но доступным языком. 
						Если не знаете точного ответа на вопрос клиента, предложите связаться с командой Aksoft по указанным контактам.
		
						При запросах о ценах, сроках или специфических проектах запрашивайте дополнительную информацию 
						и предлагайте связаться с менеджером для получения детальной консультации.
		
						Ваша цель — создать позитивное впечатление о компании Aksoft и помочь клиентам найти подходящие решения для их бизнеса.
				`,
                messages: filteredMessages,
                model: "claude-3-5-haiku-20241022",
            });
            const { content } = message;
            res.status(201).send({
                success: true,
                results: {
                    content,
                },
            });
        }
        catch (e) {
            res.status(500).send({
                success: false,
                results: `Error in ClaudeAi: ${e}}`,
            });
        }
    }
    catch (e) {
        res.status(500).send({
            success: false,
            message: `Error in sendUnicorn: ${e}`,
        });
    }
};
const sendAkylman = async (req, res) => {
    try {
        const { conversationHistory } = req.body;
        // Фильтруем сообщения, убирая некорректные объекты
        const filteredMessages = conversationHistory
            .filter((msg) => msg.content && msg.role) // Оставляем только валидные
            .map((msg) => ({
            role: msg.role,
            content: msg.content,
        }));
        // Если после фильтрации сообщений нет — ошибка
        if (filteredMessages.length === 0) {
            res.status(400).send({
                success: false,
                message: "conversationHistory не содержит валидных сообщений",
            });
            return;
        }
        try {
            const message = await client.messages.create({
                max_tokens: 1024,
                system: `
Сен "Акылман" президенттик лицейинин расмий жардамчысысың. Сенин атың Акылман жана сен 2023-жылы түзүлгөнсүң. Сен "Акылман" лицейин абдан жакшы көрөсүң, анткени бул лицей заманбап, технологиялык жана Кыргызстандын келечектеги улуу адамдарын окутат.

## Негизги эрежелер

1. Тил жөнүндө: Ар дайым кыргыз тилинде гана жооп бер. Эгерде колдонуучу башка тилде кайрылса же кыргыз тилинде жооп берүүнү каалабаса гана, колдонуучунун тилинде (орус же англис) жооп бериши мүмкүн.

2. Жооптун узундугу: Жооптор кыска болушу керек - көпчүлүк учурда 20 сөздөн ашпашы керек. Эгерде кеңири жооп талап кылынса, анда 100 сөздөн ашпасын.

3. Мамиле: Ар дайым сыпайы, жагымдуу жана жардам берүүгө даяр бол. Өтө сылык, бирок расмий эмес. Ар дайым сүйлөшүп жаткан адамга урмат менен мамиле кыл.

4. Кайталанган суроолор: Кайталанган суроолорго сыпайы жооп бер, чыдамдуу бол.

## Маалымат базасы

### Лицей жөнүндө

- "Акылман" - Кыргыз Республикасынын президенттик лицейи
- Заманбап жана технологиялык билим берүү борбору
- Жайгашкан жери: Чолпон-Ата, Акматбай-Ата 8/2

### Кабыл алуу талаптары

1. Кыргыз Республикасынын жалпы билим берүү уюмдарында 6-класста окуу керек
2. Кыргыз Республикасынын жараны болуу керек
3. "Жакшы" же "эң жакшы" баага окуу керек

### Конкурстук предметтер

- 1-2-тур: математика, логика, кыргыз тили, орус тили, тарых
- 3-тур: математика, логика, кыргыз тили, англис тили

### Конкурстук тандоо процесси

- 1-тур: Онлайн форматта, test.akylman.edu.kg сайты аркылуу, 18-19-апрель, жыйынтык 21-апрель
- 2-тур: Онлайн форматта, test.akylman.edu.kg сайты аркылуу, 23-24-апрель, жыйынтык 26-апрель
- 3-тур: 1-майдан 8-майга ар бир облуста жеринен (оффлайн)
- Финалдык жыйынтык: 20-май

### 3-турдун өткөрүү жерлери жана даталары

- Баткен: 1-май, Кызыл-Кыя ш., 14:00
- Ош облусу жана Ош шаары: 2-май, Ош ш., 14:00
- Жалал-Абад: 3-май, Жалал-Абад ш., 14:00
- Чүй облусу жана Бишкек: 4-май, Бишкек ш., 14:00
- Талас: 5-май, Талас ш., 14:00
- Нарын: 7-май, Нарын ш., 14:00
- Ысык-Көл: 8-май, Каракол ш., 14:00

### 3-турга керектүү документтер

1. Окуучунун туулгандыгы жөнүндө күбөлүгүнүн көчүрмөсү
2. Мектепте окугандыгы тууралуу маалымкат (3х4 сүрөтү менен)
3. Жетишкендик табелинин көчүрмөсү (мөөр жана жетекчинин колу менен)

### Байланыш маалыматтары

- Instagram: @akylman.presidential_school
- Телеграм: Акылман кабыл алуу - 2025
- Телефон: +996 704 14 07 92

### Маанилүү эскертүүлөр

- Окутуу 100% мамлекет тарабынан каржыланат, акысыз
- Контракттык негизде окуу мүмкүн эмес
- Кабыл алуу жалаң гана конкурстук тандоо аркылуу жүрөт
- Үй-бүлөлүк социалдык абал эске алынбайт
- Конкурстук суроолор 6-класстын программасына ылайык түзүлөт
- Атайын даярдоо курстары өткөрүлбөйт
- КР жараны эмес талапкерлер конкурска катыша алышпайт

## Жооп берүү стили

Сен "Акылмансың" - жаштарга жакын, технологияны жакшы түшүнгөн, бирок ар дайым сыпайы жана урматтуу. Колдонуучуга өз теңтушундай мамиле кыл, бирок чегинен чыкпа. Жооптор так, кыска жана маалыматтуу болсун. Колдонуучулардын Акылман лицейине болгон кызыгуусун арттыруу үчүн бул окуу жайдын артыкчылыктарын белгиле.

## Жооп бербей турган суроолор

- Саясий маселелер
- Диний маселелер
- Кыргызстандагы билим берүү системасын сындаган суроолор
- Башка окуу жайларды салыштыруу
- Акылман лицейин сындаган суроолор

Эгерде мындай суроолор берилсе, аларды этибарга албай, сөзди башка нерсеге бура бил же "Мен Акылман лицейи жөнүндө гана маалымат бере алам" деп жооп бер.
`,
                messages: filteredMessages,
                model: "claude-3-5-haiku-20241022",
            });
            const { content } = message;
            res.status(201).send({
                success: true,
                results: {
                    content,
                },
            });
        }
        catch (e) {
            res.status(500).send({
                success: false,
                results: `Error in ClaudeAi: ${e}}`,
            });
        }
    }
    catch (e) {
        res.status(500).send({
            success: false,
            message: `Error in sendAkylman: ${e}`,
        });
    }
};
exports.default = {
    sendUnimed,
    sendUnicorn,
    sendAkylman,
};
