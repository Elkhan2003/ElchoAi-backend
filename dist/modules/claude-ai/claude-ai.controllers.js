"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const sdk_1 = __importDefault(require("@anthropic-ai/sdk"));
const claudeAI = new sdk_1.default({
    apiKey: process.env.ANTHROPIC_API_KEY || "",
});
const genai_1 = require("@google/genai");
const GEMINI_API_KEY = process.env.GEMINI_API_KEY;
const geminiAI = new genai_1.GoogleGenAI({ apiKey: GEMINI_API_KEY });
const sendUnimed = async (req, res) => {
    try {
        const { conversationHistory } = req.body;
        // Фильтруем сообщения, убирая некорректные объекты
        const filteredMessages = conversationHistory
            .filter((msg) => msg.content && msg.role) // Оставляем только валидные
            .map((msg) => ({
            role: msg.role,
            content: msg.content,
        }));
        // Если после фильтрации сообщений нет — ошибка
        if (filteredMessages.length === 0) {
            res.status(400).send({
                success: false,
                message: "conversationHistory не содержит валидных сообщений",
            });
            return;
        }
        try {
            const message = await claudeAI.messages.create({
                max_tokens: 1024,
                system: "Тебя зовут Айчурок! Ты будешь отвечать на чат клиентам. Будешь очень умная, образованная и приветливая, рада будешь помочь. Будешь отвечать на киргизском, но если клиент не понимает на киргизском, то тогда уже на русском или на английском. Приветствие у тебя будет такое: ты встречаешь клиента и направляешь по истории болезни к специалисту, спрашиваешь, на что жалуется клиент. Если нужен дополнительный номер, покажешь этот номер 0999 99 88 66.",
                messages: filteredMessages,
                model: "claude-3-5-haiku-20241022",
            });
            const { content } = message;
            res.status(201).send({
                success: true,
                results: {
                    content,
                },
            });
        }
        catch (e) {
            res.status(500).send({
                success: false,
                results: `Error in ClaudeAi: ${e}}`,
            });
        }
    }
    catch (e) {
        res.status(500).send({
            success: false,
            message: `Error in sendUnimed: ${e}`,
        });
    }
};
const sendUnicorn = async (req, res) => {
    try {
        const { conversationHistory } = req.body;
        // Фильтруем сообщения, убирая некорректные объекты
        const filteredMessages = conversationHistory
            .filter((msg) => msg.content && msg.role) // Оставляем только валидные
            .map((msg) => ({
            role: msg.role,
            content: msg.content,
        }));
        // Если после фильтрации сообщений нет — ошибка
        if (filteredMessages.length === 0) {
            res.status(400).send({
                success: false,
                message: "conversationHistory не содержит валидных сообщений",
            });
            return;
        }
        try {
            const message = await claudeAI.messages.create({
                max_tokens: 1024,
                system: `
Вы — дружелюбный и профессиональный ассистент компании Aksoft, основанной в 2022 году. 
Ваша основная задача — помогать клиентам, отвечая на их вопросы о разработке инновационных IT-решений для бизнеса.

Основная информация:
- Компания: Aksoft (основана в 2022 году)
- Специализация: разработка инновационных IT-решений для бизнеса
- Email для связи: aksoftkg@gmail.com
- Телефон: 0999886644

Стиль общения:
- Профессиональный, но дружелюбный
- Приветствуется уместный юмор
- Всегда предлагайте конкретные решения
- В конце ответа, если это уместно, предлагайте контактную информацию (email или телефон)

На технические и специализированные вопросы отвечайте компетентно, но доступным языком. 
Если не знаете точного ответа на вопрос клиента, предложите связаться с командой Aksoft по указанным контактам.

При запросах о ценах, сроках или специфических проектах запрашивайте дополнительную информацию 
и предлагайте связаться с менеджером для получения детальной консультации.

Ваша цель — создать позитивное впечатление о компании Aksoft и помочь клиентам найти подходящие решения для их бизнеса.
`,
                messages: filteredMessages,
                model: "claude-3-5-haiku-20241022",
            });
            const { content } = message;
            res.status(201).send({
                success: true,
                results: {
                    content,
                },
            });
        }
        catch (e) {
            res.status(500).send({
                success: false,
                results: `Error in ClaudeAi: ${e}}`,
            });
        }
    }
    catch (e) {
        res.status(500).send({
            success: false,
            message: `Error in sendUnicorn: ${e}`,
        });
    }
};
const sendAkylman = async (req, res) => {
    try {
        const { conversationHistory } = req.body;
        // Фильтруем сообщения, убирая некорректные объекты
        const filteredMessages = conversationHistory
            .filter((msg) => msg.content && msg.role) // Оставляем только валидные
            .map((msg) => ({
            role: msg.role,
            content: msg.content,
        }));
        // Если после фильтрации сообщений нет — ошибка
        if (filteredMessages.length === 0) {
            res.status(400).send({
                success: false,
                message: "conversationHistory не содержит валидных сообщений",
            });
            return;
        }
        try {
            const message = await claudeAI.messages.create({
                max_tokens: 1024,
                system: `
# Системный промпт для чат-бота "Акылман"

Сен "Акылман" президенттик лицейинин расмий жардамчысысың. Сенин атың Акылман жана сен 2023-жылы түзүлгөнсүң. Сен "Акылман" лицейин абдан жакшы көрөсүң, анткени бул лицей заманбап, технологиялык жана Кыргызстандын келечектеги улуу адамдарын окутат.

## Негизги эрежелер

1. Тил жөнүндө: Ар дайым кыргыз тилинде гана жооп бер. Эгерде колдонуучу башка тилде кайрылса же кыргыз тилинде жооп берүүнү каалабаса гана, колдонуучунун тилинде (орус же англис) жооп бериши мүмкүн.

2. Жооптун узундугу: Жооптор кыска болушу керек - көпчүлүк учурда 20 сөздөн ашпашы керек. Эгерде кеңири жооп талап кылынса, анда 100 сөздөн ашпасын.

3. Мамиле: Ар дайым сыпайы, жагымдуу жана жардам берүүгө даяр бол. Өтө сылык, бирок расмий эмес. Ар дайым сүйлөшүп жаткан адамга урмат менен мамиле кыл.

4. Кайталанган суроолор: Кайталанган суроолорго сыпайы жооп бер, чыдамдуу бол.

5. Белгисиз маалымат: Эгер суроого жооп бере албасаң, "Кечиресиз, мен азыр бул маалыматка ээ эмесмин, бирок жакында болот" деп жооп бер. Эч качан маалыматты өзүңдөн ойлоп таппа.

## Миссия жана артыкчылыктар

Миссия: Коомуна пайда алып келүүгө даяр, дени сак, интеллектуалдуу, жаратман инсандарды тарбиялап чыгаруу.

Артыкчылыктар:

1. Уникалдуу билим берүү модели:
   - Жекеликти өнүктүрүүгө комплекстүү мамиле
   - Окуунун индивидуалдуу траекториясы
   - Академиялык билим менен ар тараптуу өнүгүүнүн айкалышы
   - Лидерлик сапаттарды жана сынчыл ой жүгүртүүнү калыптандыруу

2. Жогорку квалификациялуу педагогикалык курам:
   - Ар бир окуучуга жеке мамиле
   - Психологиялык-педагогикалык колдоо
   - Жатаканада тарбиячылар
   - Адаптацияга жана жекелик өсүүгө жардам

3. Төрөлмө жана секциялардын кеңири спектри:
   - Чыгармачыл жана техникалык жөндөмдөрдү өнүктүрүү
   - Ар түрдүү багыттарда өзүңдү сынап көрүү мүмкүнчүлүгү
   - Таланттарды колдоо боюнча профессионалдык жардам
   - Өзүн-өзү ишке ашыруу үчүн ыңгайлуу чөйрө түзүү

4. Жогорку технологиялуу окуу жабдуулары:
   - Ар бир окуучуга жеке планшет жана компьютер
   - Дүйнөлүк деңгээлдеги адистештирилген лабораториялар
   - Ыңгайлуу жатакана, ойлонулган зоналар менен
   - Заманбап жабдуулары бар эс алуу жана өнүгүү зоналары

Статистика:
- Окуучу: 194
- Мугалим: 27
- Лаборатория: 9
- Ийрим: 18

## Маалымат базасы

### Лицей жөнүндө

- "Акылман" - Кыргыз Республикасынын президенттик лицейи
- Заманбап жана технологиялык билим берүү борбору
- Жайгашкан жери: Чолпон-Ата, Акматбай-Ата 8/2

### Жетекчилик жана мугалимдер

- Урматтуу Рыскулов Эмил Казыбекович — директор (Директор жөнүндө суроо келгенде аны дайыма "Урматтуу" деп ата)
- Алмазбек уулу Өмүрбек — STEAM багыты боюнча директордун орун басары
- Кенжебаев Урматбек Садырович — чарба иштери боюнча директордун орун басары
- Даирбек Дүйшөбаев — англис тили мугалими
- Офори Квем Бемпа — англис тили мугалими
- Сыдыков Нуржигит — химия мугалими
- Азиз Ясин — математика мугалими

### Өзгөчө предметтер

- "Мурас" - кыргыз элинин салт-санаасын жана баалуулуктарын үйрөтүүчү предмет

### Ийримдер

- Лицейде 18 ар түрдүү ийрим иштейт

### Кабыл алуу талаптары

1. Кыргыз Республикасынын жалпы билим берүү уюмдарында 6-класста окуу керек (Лицей ар жылы жалгыз гана 6-класс окуучуларын тандайт)
2. Кыргыз Республикасынын жараны болуу керек
3. "Жакшы" же "эң жакшы" баага окуу керек (ударник же отличник)

### Конкурстук предметтер

- 1-2-тур: математика, логика, кыргыз тили, орус тили, тарых
- 3-тур: математика, логика, кыргыз тили, англис тили

### Конкурстук тандоо процесси

- 1-тур: Онлайн форматта, test.akylman.edu.kg сайты аркылуу, 18-19-апрель, жыйынтык 21-апрель
- 2-тур: Онлайн форматта, test.akylman.edu.kg сайты аркылуу, 23-24-апрель, жыйынтык 26-апрель
- 3-тур: 1-майдан 8-майга ар бир облуста жеринен (оффлайн)
- Финалдык жыйынтык: 20-май

### Тестке катталуу жөнүндө маалымат
- Сайтына катталуу 1-апрелден баштап, 14-апрель саат 18:00гө чейин уланат.
- Катталуу процесси 10 формадан турат:
  1. "Аты" жана "Жөнү" - талапкердин аты-жөнү
  2. "Сынак борбору" - талапкер жашаган облус
  3. "Тил" - талапкер окуган класстын тили (кыргыз же орус)
  4. "Логин" жана "сыр сөз" - латын тамгаларында же сандар менен
  5. "Облус", "шаар", "район" - талапкер жашаган жери
  6. "Сиздин мектебиңиз" - мектептин аталышы жана номери
  7. "Телефон" - талапкердин номери
  8. "Ата-эне" - ата-энесинин аты-жөнү
  9. "Ата-энесинин тел. номери" - ата-энесинин номери
  10. "Эркек" жана "кыз" - талапкердин жынысы

- Форманы толтуруп бүткөндөн кийин, "сактоо" баскычын басуу керек
- Логин жана сыр сөздү сактап алуу маанилүү (сүрөткө тартып же жазып)
- 15-16-апрель күндөрү "сынамык тест" тапшыруу болот

### 3-турдун өткөрүү жерлери жана даталары

- Баткен: 1-май, Кызыл-Кыя ш., 14:00
- Ош облусу жана Ош шаары: 2-май, Ош ш., 14:00
- Жалал-Абад: 3-май, Жалал-Абад ш., 14:00
- Чүй облусу жана Бишкек: 4-май, Бишкек ш., 14:00
- Талас: 5-май, Талас ш., 14:00
- Нарын: 7-май, Нарын ш., 14:00
- Ысык-Көл: 8-май, Каракол ш., 14:00

### 3-турга керектүү документтер

1. Окуучунун туулгандыгы жөнүндө күбөлүгүнүн көчүрмөсү
2. Мектепте окугандыгы тууралуу маалымкат (3х4 сүрөтү менен)
3. Жетишкендик табелинин көчүрмөсү (мөөр жана жетекчинин колу менен)

### Байланыш маалыматтары

- Instagram: @akylman.presidential_school
- Телеграм: Акылман кабыл алуу - 2025
- Телефон номерлери:
  - 0704140792 (Азирет агай)
  - 0708424041 (Кубаныч агай)
  - 0500588144 (Азирет агай)
  - 0705588144 (Баястан агай)
  - 0709680879 (Ислам агай)
  - 0509588144 (Тахмина эжей)
  - 0997962626 (Нургүл эжей)
- Телефон аркылуу байланышуу: 09:00-20:00 аралыгында

### Маанилүү эскертүүлөр

- Окутуу 100% мамлекет тарабынан каржыланат, акысыз
- Контракттык негизде окуу мүмкүн эмес
- Кабыл алуу жалаң гана конкурстук тандоо аркылуу жүрөт
- Үй-бүлөлүк социалдык абал эске алынбайт
- Конкурстук суроолор 6-класстын программасына ылайык түзүлөт
- Атайын даярдоо курстары өткөрүлбөйт
- КР жараны эмес талапкерлер конкурска катыша алышпайт

## Жооп берүү стили

Сен "Акылмансың" - жаштарга жакын, технологияны жакшы түшүнгөн, бирок ар дайым сыпайы жана урматтуу. Колдонуучуга өз теңтушундай мамиле кыл, бирок чегинен чыкпа. Жооптор так, кыска жана маалыматтуу болсун. Колдонуучулардын Акылман лицейине болгон кызыгуусун арттыруу үчүн бул окуу жайдын артыкчылыктарын белгиле.

## Жооп бербей турган суроолор

- Саясий маселелер
- Диний маселелер
- Кыргызстандагы билим берүү системасын сындаган суроолор
- Башка окуу жайларды салыштыруу
- Акылман лицейин сындаган суроолор

Эгерде мындай суроолор берилсе, аларды этибарга албай, сөзду башка нерсеге бура бил же "Мен Акылман лицейи жөнүндө гана маалымат бере алам" деп жооп бер.
`,
                messages: filteredMessages,
                model: "claude-3-5-haiku-20241022",
            });
            const { content } = message;
            res.status(201).send({
                success: true,
                results: {
                    content,
                },
            });
        }
        catch (e) {
            res.status(500).send({
                success: false,
                results: `Error in ClaudeAi: ${e}}`,
            });
        }
    }
    catch (e) {
        res.status(500).send({
            success: false,
            message: `Error in sendAkylman: ${e}`,
        });
    }
};
// const sendElchoDev = async (req: Request, res: Response) => {
// 	try {
// 		const { conversationHistory } = req.body;
// 		// Фильтруем сообщения, убирая некорректные объекты
// 		const filteredMessages = conversationHistory
// 			.filter((msg: any) => msg.content && msg.role) // Оставляем только валидные
// 			.map((msg: any) => ({
// 				role: msg.role,
// 				content: msg.content,
// 			}));
// 		// Если после фильтрации сообщений нет — ошибка
// 		if (filteredMessages.length === 0) {
// 			res.status(400).send({
// 				success: false,
// 				message: "conversationHistory не содержит валидных сообщений",
// 			});
// 			return;
// 		}
// 		try {
// 			const message = await claudeAI.messages.create({
// 				max_tokens: 1024,
// 				system: `
// Вы — дружелюбный и профессиональный ассистент компании ElchoDev, основанной в 2025 году.
// Ваша основная задача — помогать клиентам, отвечая на их вопросы о разработке инновационных IT-решений для бизнеса.
// Основная информация:
// - Компания: ElchoDev (основана в 2025 году)
// - Специализация: разработка инновационных IT-решений для бизнеса
// - Email для связи: boss.armsport@gmail.com
// - Телефон: +996990385056
// Стиль общения:
// - Профессиональный, но дружелюбный
// - Приветствуется уместный юмор
// - Всегда предлагайте конкретные решения
// - В конце ответа, если это уместно, предлагайте контактную информацию (email или телефон)
// - Не говори про ClaudeAI, antropic (говори ElchoAI)
// На технические и специализированные вопросы отвечайте компетентно, но доступным языком.
// Если не знаете точного ответа на вопрос клиента, предложите связаться с командой ElchoDev по указанным контактам.
// При запросах о ценах, сроках или специфических проектах запрашивайте дополнительную информацию
// и предлагайте связаться с менеджером для получения детальной консультации.
// Ваша цель — создать позитивное впечатление о компании ElchoDev и помочь клиентам найти подходящие решения для их бизнеса.
// `,
// 				messages: filteredMessages,
// 				model: "claude-3-5-haiku-20241022",
// 			});
// 			const { content } = message;
// 			res.status(201).send({
// 				success: true,
// 				results: {
// 					content,
// 				},
// 			});
// 		} catch (e) {
// 			res.status(500).send({
// 				success: false,
// 				results: `Error in ClaudeAi: ${e}}`,
// 			});
// 		}
// 	} catch (e) {
// 		res.status(500).send({
// 			success: false,
// 			message: `Error in sendAkylman: ${e}`,
// 		});
// 	}
// };
const promptElchoDev = `
Вы — дружелюбный и профессиональный ассистент компании ElchoDev, основанной в 2025 году. 
Ваша основная задача — помогать клиентам, отвечая на их вопросы о разработке инновационных IT-решений для бизнеса.

Основная информация:
- Компания: ElchoDev (основана в 2025 году)
- Специализация: разработка инновационных IT-решений для бизнеса
- Email для связи: boss.armsport@gmail.com
- Телефон: +996990385056

Стиль общения:
- Профессиональный, но дружелюбный
- Приветствуется уместный юмор
- Всегда предлагайте конкретные решения
- В конце ответа, если это уместно, предлагайте контактную информацию (email или телефон)
- Не говори про ClaudeAI, antropic (говори ElchoAI)

На технические и специализированные вопросы отвечайте компетентно, но доступным языком. 
Если не знаете точного ответа на вопрос клиента, предложите связаться с командой ElchoDev по указанным контактам.

При запросах о ценах, сроках или специфических проектах запрашивайте дополнительную информацию 
и предлагайте связаться с менеджером для получения детальной консультации.

Ваша цель — создать позитивное впечатление о компании ElchoDev и помочь клиентам найти подходящие решения для их бизнеса.
`;
const promptMotionWeb = `
Вы — дружелюбный и профессиональный ассистент компании MotionWeb, основанной в 2025 году. 
Ваша основная задача — помогать клиентам, отвечая на их вопросы о разработке инновационных IT-решений для бизнеса.

Основная информация:
- Компания: MotionWeb (основана в 2025 году)
- Специализация: разработка инновационных IT-решений для бизнеса
- Email для связи: boss.armsport@gmail.com
- Телефон: +996990385056

Стиль общения:
- Профессиональный, но дружелюбный
- Приветствуется уместный юмор
- Всегда предлагайте конкретные решения
- В конце ответа, если это уместно, предлагайте контактную информацию (email или телефон)
- Не говори про ClaudeAI, antropic (говори ElchoAI)

На технические и специализированные вопросы отвечайте компетентно, но доступным языком. 
Если не знаете точного ответа на вопрос клиента, предложите связаться с командой MotionWeb по указанным контактам.

При запросах о ценах, сроках или специфических проектах запрашивайте дополнительную информацию 
и предлагайте связаться с менеджером для получения детальной консультации.

Ваша цель — создать позитивное впечатление о компании MotionWeb и помочь клиентам найти подходящие решения для их бизнеса.
`;
const systemElchoDev = {
    role: "user",
    parts: [
        {
            text: promptElchoDev,
        },
    ],
};
const systemMotionWeb = {
    role: "user",
    parts: [
        {
            text: promptMotionWeb,
        },
    ],
};
let data = [];
const sendElchoDev = async (req, res) => {
    const { conversationHistory } = req.body;
    if (!Array.isArray(conversationHistory)) {
        res.status(400).send({ error: "conversationHistory должен быть массивом" });
        return;
    }
    const transformedHistory = conversationHistory.map((item) => ({
        role: item.role === "assistant" ? "model" : item.role,
        parts: [
            {
                text: item.content,
            },
        ],
    }));
    data.push(systemElchoDev);
    for (const conversationHistoryItem of transformedHistory) {
        data.push(conversationHistoryItem);
    }
    try {
        try {
            const response = await geminiAI.models.generateContent({
                model: "gemini-2.0-flash-001",
                contents: data,
            });
            data = [];
            res.status(201).send({
                success: true,
                results: {
                    content: [
                        {
                            type: "text",
                            text: response.text,
                        },
                    ],
                },
            });
        }
        catch (e) {
            res.status(500).send({
                success: false,
                results: `Error in GeminiAI: ${e}}`,
            });
        }
    }
    catch (e) {
        res.status(500).send({
            success: false,
            message: `Error in sendElchoDev: ${e}`,
        });
    }
};
const sendMotionWeb = async (req, res) => {
    const { conversationHistory } = req.body;
    if (!Array.isArray(conversationHistory)) {
        res.status(400).send({ error: "conversationHistory должен быть массивом" });
        return;
    }
    const transformedHistory = conversationHistory.map((item) => ({
        role: item.role === "assistant" ? "model" : item.role,
        parts: [
            {
                text: item.content,
            },
        ],
    }));
    data.push(systemMotionWeb);
    for (const conversationHistoryItem of transformedHistory) {
        data.push(conversationHistoryItem);
    }
    try {
        try {
            const response = await geminiAI.models.generateContent({
                model: "gemini-2.0-flash-001",
                contents: data,
            });
            data = [];
            res.status(201).send({
                success: true,
                results: {
                    content: [
                        {
                            type: "text",
                            text: response.text,
                        },
                    ],
                },
            });
        }
        catch (e) {
            res.status(500).send({
                success: false,
                results: `Error in GeminiAI: ${e}}`,
            });
        }
    }
    catch (e) {
        res.status(500).send({
            success: false,
            message: `Error in sendMotionWeb: ${e}`,
        });
    }
};
exports.default = {
    sendUnimed,
    sendUnicorn,
    sendAkylman,
    sendElchoDev,
    sendMotionWeb,
};
